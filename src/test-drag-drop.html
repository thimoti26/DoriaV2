<!DOCTYPE html>
<html>
<head>
    <title>Test Drag and Drop SVI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Test de Validation - Drag and Drop SVI</h1>
    
    <div class="test-section">
        <h2>Tests d'Intégrité JavaScript</h2>
        <div id="js-tests"></div>
    </div>

    <div class="test-section">
        <h2>Test d'Événements Drag and Drop</h2>
        <div id="drag-tests"></div>
    </div>

    <div class="test-section">
        <h2>Instructions pour Test Manuel</h2>
        <ol>
            <li>Aller sur <a href="/svi-admin/" target="_blank">Interface SVI Admin</a></li>
            <li>Vérifier que les éléments de la sidebar ont l'attribut <code>draggable="true"</code></li>
            <li>Glisser un élément "Menu Audio" vers le diagramme</li>
            <li>Vérifier qu'un nouveau nœud apparaît</li>
            <li>Essayer de déplacer le nœud créé</li>
            <li>Ouvrir la console (F12) pour voir les logs de debug</li>
        </ol>
    </div>

    <script>
        // Test des fonctions JavaScript
        function testJavaScriptIntegrity() {
            const results = document.getElementById('js-tests');
            let tests = [];

            // Test 1: Vérifier le support du drag and drop
            const dragSupported = 'draggable' in document.createElement('div');
            tests.push({
                name: "Support Drag and Drop natif",
                result: dragSupported,
                message: dragSupported ? "✅ Navigateur compatible" : "❌ Drag and drop non supporté"
            });

            // Test 2: Vérifier les API DataTransfer
            const dataTransferSupported = 'DataTransfer' in window;
            tests.push({
                name: "API DataTransfer",
                result: dataTransferSupported,
                message: dataTransferSupported ? "✅ DataTransfer disponible" : "❌ DataTransfer manquant"
            });

            // Test 3: Vérifier la création d'éléments
            try {
                const testDiv = document.createElement('div');
                testDiv.draggable = true;
                testDiv.style.position = 'absolute';
                tests.push({
                    name: "Création d'éléments draggables",
                    result: true,
                    message: "✅ Création d'éléments OK"
                });
            } catch (e) {
                tests.push({
                    name: "Création d'éléments draggables",
                    result: false,
                    message: "❌ Erreur: " + e.message
                });
            }

            // Afficher les résultats
            let html = '';
            tests.forEach(test => {
                const className = test.result ? 'success' : 'error';
                html += `<div class="${className}">${test.message}</div>`;
            });
            results.innerHTML = html;
        }

        // Test des événements drag and drop
        function testDragDropEvents() {
            const results = document.getElementById('drag-tests');
            let eventTests = [];

            // Créer un élément de test
            const testElement = document.createElement('div');
            testElement.textContent = 'Élément de test (draggable)';
            testElement.draggable = true;
            testElement.style.cssText = 'padding: 10px; background: #f0f0f0; border: 1px dashed #ccc; margin: 10px 0; cursor: grab;';
            
            // Zone de drop de test
            const dropZone = document.createElement('div');
            dropZone.textContent = 'Zone de drop de test';
            dropZone.style.cssText = 'padding: 20px; background: #e6f3ff; border: 2px dashed #007bff; margin: 10px 0; min-height: 60px;';

            let eventsTriggered = {
                dragstart: false,
                dragend: false,
                dragover: false,
                drop: false
            };

            // Événements de test
            testElement.addEventListener('dragstart', (e) => {
                eventsTriggered.dragstart = true;
                e.dataTransfer.setData('text/plain', 'test-data');
                updateEventStatus();
            });

            testElement.addEventListener('dragend', (e) => {
                eventsTriggered.dragend = true;
                updateEventStatus();
            });

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                eventsTriggered.dragover = true;
                updateEventStatus();
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                eventsTriggered.drop = true;
                const data = e.dataTransfer.getData('text/plain');
                dropZone.innerHTML += `<br><span class="success">✅ Drop réussi! Données: ${data}</span>`;
                updateEventStatus();
            });

            function updateEventStatus() {
                let status = '<h3>Statut des Événements:</h3>';
                Object.keys(eventsTriggered).forEach(event => {
                    const triggered = eventsTriggered[event];
                    const className = triggered ? 'success' : 'info';
                    const icon = triggered ? '✅' : '⏳';
                    status += `<div class="${className}">${icon} ${event}: ${triggered ? 'Déclenché' : 'En attente'}</div>`;
                });
                results.innerHTML = status;
            }

            // Ajouter les éléments à la page
            results.appendChild(testElement);
            results.appendChild(dropZone);
            updateEventStatus();
        }

        // Lancer les tests au chargement
        window.onload = function() {
            testJavaScriptIntegrity();
            testDragDropEvents();
        };
    </script>
</body>
</html>

[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
CONSOLE=Console/dsp

[default]
; Default context for external calls
exten => _X.,1,Noop(External call to ${EXTEN})
exten => _X.,n,Hangup()

[from-internal]
; Internal extensions pour PJSIP
exten => 1001,1,Noop(Calling User 1001)
exten => 1001,n,Dial(PJSIP/1001,30)
exten => 1001,n,Voicemail(1001@default,u)
exten => 1001,n,Hangup()

exten => 1002,1,Noop(Calling User 1002)
exten => 1002,n,Dial(PJSIP/1002,30)
exten => 1002,n,Voicemail(1002@default,u)
exten => 1002,n,Hangup()

exten => 1003,1,Noop(Calling User 1003)
exten => 1003,n,Dial(PJSIP/1003,30)
exten => 1003,n,Voicemail(1003@default,u)
exten => 1003,n,Hangup()

exten => 1004,1,Noop(Calling User 1004)
exten => 1004,n,Dial(PJSIP/1004,30)
exten => 1004,n,Voicemail(1004@default,u)
exten => 1004,n,Hangup()

; Test extension for volume configuration
exten => 999,1,Noop(Test extension for volume config - modified from host)
exten => 999,n,Answer()
exten => 999,n,Playback(hello-world)
exten => 999,n,SayDigits(${EPOCH})
exten => 999,n,Hangup()

; Test d'écho pour vérifier la qualité audio
exten => *43,1,Noop(Echo test - Start)
exten => *43,n,Answer()
exten => *43,n,Wait(2)
exten => *43,n,Playback(demo-echotest,noanswer)
exten => *43,n,Wait(1)
exten => *43,n,Echo()
exten => *43,n,Hangup()

; Test audio simple
exten => *44,1,Noop(Simple audio test - Start)
exten => *44,n,Answer()
exten => *44,n,Wait(2)
exten => *44,n,Playback(hello-world,noanswer)
exten => *44,n,Wait(2)
exten => *44,n,Playback(demo-thanks,noanswer)
exten => *44,n,Wait(2)
exten => *44,n,Hangup()

; Test audio très simple avec tonalité
exten => *45,1,Noop(Simple tone test)
exten => *45,n,Answer()
exten => *45,n,Wait(1)
exten => *45,n,Playtones(440)
exten => *45,n,Wait(3)
exten => *45,n,StopPlaytones()
exten => *45,n,Wait(1)
exten => *45,n,Hangup()

; Accès à la messagerie vocale
exten => *97,1,Noop(Voicemail access)
exten => *97,n,VoiceMailMain(${CALLERID(num)}@default)
exten => *97,n,Hangup()

; Extension de démonstration
exten => 100,1,Noop(Demo extension)
exten => 100,n,Answer()
exten => 100,n,Wait(1)
exten => 100,n,Playback(demo-congrats)
exten => 100,n,Hangup()

; Salle de conférence
exten => 8000,1,Noop(Conference room)
exten => 8000,n,Answer()
exten => 8000,n,ConfBridge(conference1)
exten => 8000,n,Hangup()

; Serveur Vocal Interactif (SVI)
exten => 9999,1,Noop(Main IVR - Interactive Voice Response)
exten => 9999,n,Goto(ivr-language,s,1)

[ivr-language]
; === SÉLECTION DE LANGUE ===
; Choix initial : Français ou Anglais
exten => s,1,Noop(Language Selection)
exten => s,n,Answer()
exten => s,n,Wait(1)
exten => s,n,Set(TIMEOUT(digit)=5)
exten => s,n,Set(TIMEOUT(response)=10)
exten => s,n(langmenu),Background(custom/language-prompt)  ; "Pour français, tapez 1. For English, press 2"
exten => s,n,WaitExten(10)

; Option 1 - Français
exten => 1,1,Noop(French language selected)
exten => 1,n,Set(LANGUAGE=fr)
exten => 1,n,Set(AUDIO_PREFIX=custom/fr)
exten => 1,n,Background(custom/fr/language-selected)  ; "Français sélectionné"
exten => 1,n,Goto(ivr-main,s,1)

; Option 2 - Anglais
exten => 2,1,Noop(English language selected)
exten => 2,n,Set(LANGUAGE=en)
exten => 2,n,Set(AUDIO_PREFIX=custom/en)
exten => 2,n,Background(custom/en/language-selected)  ; "English selected"
exten => 2,n,Goto(ivr-main-en,s,1)

; Gestion des erreurs - touche invalide
exten => i,1,Noop(Invalid language option)
exten => i,n,Background(custom/language-invalid)  ; "Option invalide. Invalid option"
exten => i,n,Goto(s,langmenu)

; Gestion du timeout - pas de réponse
exten => t,1,Noop(Language timeout)
exten => t,n,Background(custom/language-timeout)  ; "Pas de réponse, français par défaut. No response, defaulting to French"
exten => t,n,Set(LANGUAGE=fr)
exten => t,n,Set(AUDIO_PREFIX=custom/fr)
exten => t,n,Goto(ivr-main,s,1)

[ivr-main]
; === SERVEUR VOCAL INTERACTIF (SVI) - FRANÇAIS ===
; Extension principale du SVI en français
exten => s,1,Noop(Entering Main IVR - French)
exten => s,n,Answer()
exten => s,n,Wait(1)
exten => s,n,Set(TIMEOUT(digit)=5)
exten => s,n,Set(TIMEOUT(response)=10)
exten => s,n(menu),Background(custom/fr/welcome)  ; "Bienvenue sur le serveur DoriaV2"
exten => s,n,Background(custom/fr/menu-main)      ; "Pour joindre le service commercial, tapez 1..."
exten => s,n,WaitExten(10)

; Option 1 - Service Commercial
exten => 1,1,Noop(Commercial Department - French)
exten => 1,n,Background(custom/fr/commercial)
exten => 1,n,Dial(PJSIP/1001,30)
exten => 1,n,Voicemail(1001@default,u)
exten => 1,n,Hangup()

; Option 2 - Support Technique
exten => 2,1,Noop(Technical Support - French)
exten => 2,n,Background(custom/fr/support)
exten => 2,n,Dial(PJSIP/1002,30)
exten => 2,n,Voicemail(1002@default,u)
exten => 2,n,Hangup()

; Option 3 - Salle de conférence
exten => 3,1,Noop(Conference Room Access - French)
exten => 3,n,Background(custom/fr/conference)
exten => 3,n,ConfBridge(conference1)
exten => 3,n,Hangup()

; Option 4 - Répertoire téléphonique
exten => 4,1,Noop(Directory - French)
exten => 4,n,Background(custom/fr/directory)
exten => 4,n,Directory(default,from-internal)
exten => 4,n,Hangup()

; Option 8 - Changer de langue
exten => 8,1,Noop(Change language)
exten => 8,n,Background(custom/fr/change-language)  ; "Changement de langue"
exten => 8,n,Goto(ivr-language,s,langmenu)

; Option 9 - Retour au menu principal
exten => 9,1,Noop(Return to main menu - French)
exten => 9,n,Goto(s,menu)

; Option 0 - Opérateur (User 1003)
exten => 0,1,Noop(Operator - French)
exten => 0,n,Background(custom/fr/operator)
exten => 0,n,Dial(PJSIP/1003,30)
exten => 0,n,Voicemail(1003@default,u)
exten => 0,n,Hangup()

; Gestion des erreurs - touche invalide
exten => i,1,Noop(Invalid option - French)
exten => i,n,Background(custom/fr/invalid)
exten => i,n,Goto(s,menu)

; Gestion du timeout - pas de réponse
exten => t,1,Noop(Timeout - French)
exten => t,n,Background(custom/fr/timeout)
exten => t,n,Goto(s,menu)

[ivr-main-en]
; === INTERACTIVE VOICE RESPONSE (IVR) - ENGLISH ===
; Main IVR extension in English
exten => s,1,Noop(Entering Main IVR - English)
exten => s,n,Answer()
exten => s,n,Wait(1)
exten => s,n,Set(TIMEOUT(digit)=5)
exten => s,n,Set(TIMEOUT(response)=10)
exten => s,n(menu),Background(custom/en/welcome)  ; "Welcome to DoriaV2 server"
exten => s,n,Background(custom/en/menu-main)      ; "For sales department, press 1..."
exten => s,n,WaitExten(10)

; Option 1 - Sales Department
exten => 1,1,Noop(Sales Department - English)
exten => 1,n,Background(custom/en/commercial)
exten => 1,n,Dial(PJSIP/1001,30)
exten => 1,n,Voicemail(1001@default,u)
exten => 1,n,Hangup()

; Option 2 - Technical Support
exten => 2,1,Noop(Technical Support - English)
exten => 2,n,Background(custom/en/support)
exten => 2,n,Dial(PJSIP/1002,30)
exten => 2,n,Voicemail(1002@default,u)
exten => 2,n,Hangup()

; Option 3 - Conference Room
exten => 3,1,Noop(Conference Room Access - English)
exten => 3,n,Background(custom/en/conference)
exten => 3,n,ConfBridge(conference1)
exten => 3,n,Hangup()

; Option 4 - Directory
exten => 4,1,Noop(Directory - English)
exten => 4,n,Background(custom/en/directory)
exten => 4,n,Directory(default,from-internal)
exten => 4,n,Hangup()

; Option 8 - Change language
exten => 8,1,Noop(Change language)
exten => 8,n,Background(custom/en/change-language)  ; "Language change"
exten => 8,n,Goto(ivr-language,s,langmenu)

; Option 9 - Return to main menu
exten => 9,1,Noop(Return to main menu - English)
exten => 9,n,Goto(s,menu)

; Option 0 - Operator (User 1003)
exten => 0,1,Noop(Operator - English)
exten => 0,n,Background(custom/en/operator)
exten => 0,n,Dial(PJSIP/1003,30)
exten => 0,n,Voicemail(1003@default,u)
exten => 0,n,Hangup()

; Error handling - invalid key
exten => i,1,Noop(Invalid option - English)
exten => i,n,Background(custom/en/invalid)
exten => i,n,Goto(s,menu)

; Timeout handling - no response
exten => t,1,Noop(Timeout - English)
exten => t,n,Background(custom/en/timeout)
exten => t,n,Goto(s,menu)

[ivr-hours]
; === SVI POUR LES HEURES D'OUVERTURE ===
exten => s,1,Noop(Hours Information)
exten => s,n,Answer()
exten => s,n,Wait(1)
exten => s,n,Background(custom/hours)  ; Infos sur les heures d'ouverture
exten => s,n,Background(custom/menu-after-hours)
exten => s,n,WaitExten(10)

; Salle de conférence alternative pour heures non-ouvrées
exten => 8001,1,Noop(Conference room - After hours context)
exten => 8001,n,Answer()
exten => 8001,n,ConfBridge(conference2)
exten => 8001,n,Hangup()

; Test de connexion SIP
exten => *123,1,Noop(SIP Connection Test)
exten => *123,n,Answer()
exten => *123,n,Wait(1)
exten => *123,n,SayDigits(12345)
exten => *123,n,Wait(2)
exten => *123,n,Playback(demo-thanks)
exten => *123,n,Hangup()

; Support des appels entre extensions (pattern matching)
exten => _10XX,1,Noop(Calling extension ${EXTEN})
exten => _10XX,n,Dial(PJSIP/${EXTEN},30)
exten => _10XX,n,Voicemail(${EXTEN}@default,u)
exten => _10XX,n,Hangup()

[internal]
; Ancien contexte pour compatibilité
include => from-internal

; Hangup handler
exten => h,1,Hangup()

[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
CONSOLE=Console/dsp

[default]
; Default context for external calls
exten => _X.,1,Noop(External call to ${EXTEN})
exten => _X.,n,Hangup()

[from-internal]
; Internal extensions pour PJSIP
exten => 1001,1,Noop(Calling User 1001)
exten => 1001,n,Dial(PJSIP/1001,30)
exten => 1001,n,Voicemail(1001@default,u)
exten => 1001,n,Hangup()

exten => 1002,1,Noop(Calling User 1002)
exten => 1002,n,Dial(PJSIP/1002,30)
exten => 1002,n,Voicemail(1002@default,u)
exten => 1002,n,Hangup()

exten => 1003,1,Noop(Calling User 1003)
exten => 1003,n,Dial(PJSIP/1003,30)
exten => 1003,n,Voicemail(1003@default,u)
exten => 1003,n,Hangup()

exten => 1004,1,Noop(Calling User 1004)
exten => 1004,n,Dial(PJSIP/1004,30)
exten => 1004,n,Voicemail(1004@default,u)
exten => 1004,n,Hangup()

; Test extension for volume configuration
exten => 999,1,Noop(Test extension for volume config - modified from host)
exten => 999,n,Answer()
exten => 999,n,Playback(hello-world)
exten => 999,n,SayDigits(${EPOCH})
exten => 999,n,Hangup()

; Test d'écho pour vérifier la qualité audio
exten => *43,1,Noop(Echo test - Start)
exten => *43,n,Answer()
exten => *43,n,Wait(2)
exten => *43,n,Playback(demo-echotest,noanswer)
exten => *43,n,Wait(1)
exten => *43,n,Echo()
exten => *43,n,Hangup()

; Test audio simple
exten => *44,1,Noop(Simple audio test - Start)
exten => *44,n,Answer()
exten => *44,n,Wait(2)
exten => *44,n,Playback(hello-world,noanswer)
exten => *44,n,Wait(2)
exten => *44,n,Playback(demo-thanks,noanswer)
exten => *44,n,Wait(2)
exten => *44,n,Hangup()

; Test audio très simple avec tonalité
exten => *45,1,Noop(Simple tone test)
exten => *45,n,Answer()
exten => *45,n,Wait(1)
exten => *45,n,Playtones(440)
exten => *45,n,Wait(3)
exten => *45,n,StopPlaytones()
exten => *45,n,Wait(1)
exten => *45,n,Hangup()

; Accès à la messagerie vocale
exten => *97,1,Noop(Voicemail access)
exten => *97,n,VoiceMailMain(${CALLERID(num)}@default)
exten => *97,n,Hangup()

; Extension de démonstration
exten => 100,1,Noop(Demo extension)
exten => 100,n,Answer()
exten => 100,n,Wait(1)
exten => 100,n,Playback(demo-congrats)
exten => 100,n,Hangup()

; Salle de conférence
exten => 8000,1,Noop(Conference room)
exten => 8000,n,Answer()
exten => 8000,n,ConfBridge(conference1)
exten => 8000,n,Hangup()

; Serveur Vocal Interactif (SVI)
exten => 9999,1,Noop(Main IVR - Interactive Voice Response)
exten => 9999,n,Goto(ivr-main,s,1)

[ivr-main]
; === SERVEUR VOCAL INTERACTIF (SVI) ===
; Extension principale du SVI
exten => s,1,Noop(Entering Main IVR)
exten => s,n,Answer()
exten => s,n,Wait(1)
exten => s,n,Set(TIMEOUT(digit)=5)
exten => s,n,Set(TIMEOUT(response)=10)
exten => s,n(menu),Background(custom/welcome)  ; "Bienvenue sur le serveur DoriaV2"
exten => s,n,Background(custom/menu-main)      ; "Pour joindre le service commercial, tapez 1..."
exten => s,n,WaitExten(10)

; Option 1 - Service Commercial
exten => 1,1,Noop(Commercial Department)
exten => 1,n,Background(custom/commercial)
exten => 1,n,Dial(PJSIP/1001,30)
exten => 1,n,Voicemail(1001@default,u)
exten => 1,n,Hangup()

; Option 2 - Support Technique
exten => 2,1,Noop(Technical Support)
exten => 2,n,Background(custom/support)
exten => 2,n,Dial(PJSIP/1002,30)
exten => 2,n,Voicemail(1002@default,u)
exten => 2,n,Hangup()

; Option 3 - Salle de conférence
exten => 3,1,Noop(Conference Room Access)
exten => 3,n,Background(custom/conference)
exten => 3,n,ConfBridge(conference1)
exten => 3,n,Hangup()

; Option 4 - Répertoire téléphonique
exten => 4,1,Noop(Directory)
exten => 4,n,Background(custom/directory)
exten => 4,n,Directory(default,from-internal)
exten => 4,n,Hangup()

; Option 9 - Retour au menu principal
exten => 9,1,Noop(Return to main menu)
exten => 9,n,Goto(s,menu)

; Option 0 - Opérateur (User 1003)
exten => 0,1,Noop(Operator)
exten => 0,n,Background(custom/operator)
exten => 0,n,Dial(PJSIP/1003,30)
exten => 0,n,Voicemail(1003@default,u)
exten => 0,n,Hangup()

; Gestion des erreurs - touche invalide
exten => i,1,Noop(Invalid option)
exten => i,n,Background(custom/invalid)
exten => i,n,Goto(s,menu)

; Gestion du timeout - pas de réponse
exten => t,1,Noop(Timeout)
exten => t,n,Background(custom/timeout)
exten => t,n,Goto(s,menu)

[ivr-hours]
; === SVI POUR LES HEURES D'OUVERTURE ===
exten => s,1,Noop(Hours Information)
exten => s,n,Answer()
exten => s,n,Wait(1)
exten => s,n,Background(custom/hours)  ; Infos sur les heures d'ouverture
exten => s,n,Background(custom/menu-after-hours)
exten => s,n,WaitExten(10)

; Salle de conférence alternative pour heures non-ouvrées
exten => 8001,1,Noop(Conference room - After hours context)
exten => 8001,n,Answer()
exten => 8001,n,ConfBridge(conference2)
exten => 8001,n,Hangup()

; Test de connexion SIP
exten => *123,1,Noop(SIP Connection Test)
exten => *123,n,Answer()
exten => *123,n,Wait(1)
exten => *123,n,SayDigits(12345)
exten => *123,n,Wait(2)
exten => *123,n,Playback(demo-thanks)
exten => *123,n,Hangup()

; Support des appels entre extensions (pattern matching)
exten => _10XX,1,Noop(Calling extension ${EXTEN})
exten => _10XX,n,Dial(PJSIP/${EXTEN},30)
exten => _10XX,n,Voicemail(${EXTEN}@default,u)
exten => _10XX,n,Hangup()

[internal]
; Ancien contexte pour compatibilité
include => from-internal

; Hangup handler
exten => h,1,Hangup()
